name: Format via Comment

on:
   issue_comment:
      types: [created]

permissions:
   contents: write
   pull-requests: write

jobs:
   run-prettier-on-comment:
      if: |
         github.event.issue.pull_request &&
         startsWith(github.event.comment.body, '/format')
      runs-on: ubuntu-latest
      steps:
         - name: Checkout PR branch
           uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
           with:
              token: ${{ secrets.GITHUB_TOKEN }}
              repository: ${{ github.event.issue.pull_request.head.repo.full_name }}
              ref: ${{ github.event.issue.pull_request.head.ref }}

         - name: Set up Node.js
           uses: actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020 # v4.4.0
           with:
              node-version: 20

         - name: Install dependencies
           run: npm ci

         - name: Run Prettier
           run: npm run format

         - name: Commit and push formatted changes
           run: |
              git config user.name "${{ github.actor }}"
              git config user.email "${{ github.actor }}@users.noreply.github.com"

              git add .

              if git diff --cached --quiet; then
                echo "✅ No formatting changes to commit."
              else
                git commit -m "style: auto-format via /format comment"
                git push origin HEAD:${{ github.event.issue.pull_request.head.ref }}
                echo "✅ Formatting changes committed to PR branch."
              fi
